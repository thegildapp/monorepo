FROM node:20-alpine

WORKDIR /app

# Copy shared package
COPY packages/shared-schema /app/packages/shared-schema

# Now set up frontend
WORKDIR /app
COPY frontend/package*.json ./
RUN npm install

# Copy source code
COPY frontend/ .

# Copy schema from shared package
RUN cp /app/packages/shared-schema/schema.graphql ./schema.graphql

# Expose port 5173 (Vite's default port)
EXPOSE 5173

# Set default environment variables for development
ENV VITE_SPACES_ENDPOINT=https://gild.sfo3.digitaloceanspaces.com

# Generate types and start dev server
CMD ["sh", "-c", "npm run relay && npm run dev -- --host 0.0.0.0"]